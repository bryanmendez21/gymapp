{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static '/css/app.css' %}">
<link rel="stylesheet" type="text/javascript" href="{% static '/js/style.js' %}">
{% endblock %}

{% block content %}
{% if request.user.is_authenticated %}
<nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <!-- icon and pop up-->
      <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
        <img src="{% static '/imgs/profile-boy-icon.png' %}" alt="Icon Image">
      </button>

      <div class="offcanvas offcanvas-start text-bg-dark" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
          <!--user name-->
          <h5 class="offcanvas-title" id="offcanvasScrollingLabel">{{request.user}}</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <p>info</p>
        </div>
      </div>

      <!--navigation tabs-->
      <ul class="nav nav-underline" >
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="{% url 'home' %}">HOME</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="{% url 'activity' %}">ACTIVITY LOG</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'routine' %}">ROUTINE</a>
        </li>
        <li class="nav-item">
          <a  class="nav-link" href="{% url 'diet' %}">DIET PLANNING</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'composition' %}">BODY COMPOSITION</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'account' %}">ACCOUNT</a>
        </li>
      </ul>
      <!--search-->
      <form class="d-flex" role="search">
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
      <!--logout-->
      <ul class="nav nav-underline">
        <li class="nav-item">
          <a class="nav-link" href="{% url 'logout' %}?next={% url 'login' %}">logout</a>
        </li>
      </ul>

    </div>
  </nav>


  <title>Body Composition Calculator</title>
  <style>


      .bmicalc {
          position: relative; /* Set the position to relative */
          transform: translateY(10%); /* Move the content up by 50% of its own height */
          text-align: center;
          background-color: #000000eb; /* Set the background color of the content */
          padding: 20px;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.251);
      }

      input[type="number"] {
          width: 60px;
          padding: 5px;
          margin: 5px;
          text-align: center;
      }

      button {
          padding: 10px 20px;
          background-color: #007bff;
          color: #fff;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
      }

      #result {
          margin-top: 20px;
          font-weight: bold;
      }

      .underweight {
          background-color: blue;
      }

      .normal-weight {
          background-color: green;
      }

      .overweight {
          background-color: yellow;
      }

      .obese {
        background-color: red;
      }

      .weight-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%; /* This creates the circle shape */
        background-color: red; /* Set the background color to red */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: white;
        margin: 20px auto; /* Adjust margins as needed */
      }
  </style>

  <div class="bmicalc">
    <div id="weightCircle" class="weight-circle"></div>
    <canvas id="weightChart" width="400" height="200"></canvas>

    <h2>Body Composition Calculator</h2>
    <label for="weight">Weight:</label>
    <input type="number" id="weight" min="0" step="0.1">
    <select id="weightUnit">
        <option value="kg">kg</option>
        <option value="lb">lb</option>
    </select>
    <br>
    <label for="feet">Height:</label>
    <input type="number" id="feet" min="0" placeholder="Feet">
    <input type="number" id="inches" min="0" max="11" placeholder="Inches">
    <select id="heightUnit">
        <option value="cm">cm</option>
        <option value="ft">ft</option>
    </select>
    <br>
    <button onclick="calculateBMI()">Calculate BMI</button>
    <div id="result" class="result"></div>
    <div id="bmiChart">
        <h3>BMI Chart</h3>
        <p>Underweight: less than 18.5</p>
        <p>Normal weight: 18.5 - 24.9</p>
        <p>Overweight: 25 - 29.9</p>
        <p>Obese: 30 or greater</p>
    </div>
  </div>


    <script>
      function calculateBMI() {
          var weight = parseFloat(document.getElementById('weight').value);
          var feet = parseInt(document.getElementById('feet').value);
          var inches = parseInt(document.getElementById('inches').value);

          var weightUnit = document.getElementById('weightUnit').value;
          var heightUnit = document.getElementById('heightUnit').value;

          var heightInCm;

          if (heightUnit === 'ft') {
              heightInCm = (feet * 30.48) + (inches * 2.54);
          } else {
              heightInCm = parseFloat(document.getElementById('feet').value);
          }

          // Convert weight to kg if lb is selected
          if (weightUnit === 'lb') {
              weight *= 0.453592; // Convert lb to kg
          }

          if (!isNaN(weight) && !isNaN(heightInCm) && heightInCm > 0 && weight > 0) {
              var bmi = weight / ((heightInCm / 100) * (heightInCm / 100));
              var category = '';

              if (bmi < 18.5) {
                  category = 'Underweight';
                  document.getElementById('result').className = 'result underweight';
              } else if (bmi >= 18.5 && bmi < 24.9) {
                  category = 'Normal weight';
                  document.getElementById('result').className = 'result normal-weight';
              } else if (bmi >= 25 && bmi < 29.9) {
                  category = 'Overweight';
                  document.getElementById('result').className = 'result overweight';
              } else {
                  category = 'Obese';
                  document.getElementById('result').className = 'result obese';
              }

              document.getElementById('result').innerHTML = 'BMI: ' + bmi.toFixed(2) + ' (' + category + ')';
          } else {
              document.getElementById('result').innerHTML = 'Please enter valid weight and height.';
          }
      }

      function drawWeightCircle(weight) {
          var weightCircle = document.getElementById('weightCircle');
          weightCircle.innerHTML = '<div class="weight">' + weight + '</div>';
      }

      function drawWeightBMIChart(weightData, bmiData) {
          var ctx = document.getElementById('weightChart').getContext('2d');
          var myChart = new Chart(ctx, {
              type: 'line',
              data: {
                  labels: weightData.map(function(_, index) { return index + 1; }),
                  datasets: [{
                      label: 'Weight',
                      data: weightData,
                      borderColor: 'rgba(255, 99, 132, 1)',
                      borderWidth: 1
                  },
                  {
                      label: 'BMI',
                      data: bmiData,
                      borderColor: 'rgba(54, 162, 235, 1)',
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      y: {
                          beginAtZero: true
                      }
                  }
              }
          });
      }
      // Example data for weight and BMI chart
      var weightData = [/* Array of previous weight data */];
      var bmiData = [/* Array of previous BMI data */];

      // Call the functions
      drawWeightCircle(200);
      drawWeightBMIChart(weightData, bmiData);
  </script>

{% endif %}
{% endblock %}
